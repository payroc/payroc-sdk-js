# Contributing to Payroc API TypeScript SDK

## Getting Started

### Prerequisites

To build and test this source code, you'll need:

- **Node.js 18.0.0 or higher** - [Download](https://nodejs.org/)
- **pnpm 10.20.0 or higher** - [Install](https://pnpm.io/installation) (package manager)
- **Git** - [Download](https://git-scm.com/)

### Installation

#### 1. Install pnpm (if not already installed)

pnpm is the required package manager for this project. Install it globally using npm:

```bash
npm install -g pnpm
```

Verify the installation:

```bash
pnpm --version
```

#### 2. Clone the repository and install dependencies

```bash
git clone https://github.com/payroc/payroc-sdk-js.git
cd payroc-sdk-js
pnpm install
```

### Building

Build all formats (CJS, ESM, and Deno):

```bash
pnpm build
```

Build specific formats:

```bash
# CommonJS
pnpm build:cjs

# ECMAScript modules
pnpm build:esm

# Deno
pnpm build:deno
```

#### Optional Peer Dependencies

If you encounter TypeScript errors related to missing Sentry modules (`@sentry/cloudflare`, `@sentry/react-native`, etc.), you can install the optional peer dependencies:

```bash
pnpm install @sentry/cloudflare @sentry/react-native @sentry/electron
```

These are only needed if you're building or developing features related to these optional integrations.

### Project Structure

- `src/` - Main SDK source code
- `tests/` - Test files
  - `unit/` - Unit tests
  - `wire/` - Integration/wire tests
  - `mock-server/` - Mock server setup for testing

## Testing

### Prerequisites for Running Tests

Before running tests, ensure you have:

1. **Installed project dependencies**:

```bash
pnpm install
```

That's it! No external services (Docker, WireMock, etc.) need to be started manually.

### Test Framework

This project uses **Vitest** as the testing framework, with the following key features:

- **MSW (Mock Service Worker)** - API mocking for tests (automatically started)
- **Projects** - Organized test suites (unit and wire tests)
- **Node environment** - Tests run in Node.js

### Running Tests

**Important**: All test commands must be run from the **project root directory** (`payroc-sdk-js/`).

Execute all tests:

```bash
pnpm test
```

Run only unit tests:

```bash
pnpm test:unit
```

Run only wire/integration tests:

```bash
pnpm test:wire
```

> **Note:** Tests run in watch mode by default. Press `q` to quit, or `h` to see help options.

### Test Categories

- **Unit Tests** (`tests/unit/`) - Fast, isolated tests for individual components and functions
- **Wire Tests** (`tests/wire/`) - Integration tests that validate end-to-end API interactions with mock server

### How Tests Work

The test setup is fully automated:

1. **Mock Server**: MSW (Mock Service Worker) automatically starts when wire tests run via `tests/mock-server/setup.ts`
2. **Custom Matchers**: Test utilities are loaded via `tests/setup.ts`
3. **No External Services**: All API calls are mocked - no Docker, WireMock, or external services required

### Prerequisites for Running Tests in VS Code

To run and debug tests directly in VS Code, you'll need to:

1. **Install project dependencies** - Required before running tests:

```bash
pnpm install
```

2. **Install the Vitest extension** - For test discovery and execution in VS Code:

- **[Vitest](https://marketplace.visualstudio.com/items?itemName=vitest.explorer)** - Test explorer and runner for Vitest

#### Quick Setup

We've provided a setup script to automatically install the Vitest extension:

**Windows (PowerShell):**
```powershell
.\scripts\vscode\setup-extensions.ps1
```

**macOS/Linux (Bash):**
```bash
bash scripts/vscode/setup-extensions.sh
```

After running the script, reload VS Code (`Ctrl+Shift+P` > `Reload Window`) to activate the extension.

> **Note:** The setup script installs the VS Code extension only. Make sure you've already run `pnpm install` in the project root to install all required dependencies.

## Code Quality

### Formatting

Format code using Biome:

```bash
pnpm format
```

Check formatting without making changes:

```bash
pnpm format:check
```

### Linting

Run linter:

```bash
pnpm lint
```

Fix linting issues:

```bash
pnpm lint:fix
```

### Full Check

Run all checks (formatting, linting, and analysis):

```bash
pnpm check
```

Fix all issues:

```bash
pnpm check:fix
```

## About Generated Code

**Important**: Most files in this SDK are automatically generated by [Fern](https://buildwithfern.com) from the API definition. Direct modifications to generated files will be overwritten the next time the SDK is generated.

### Generated Files

The following directories contain generated code:
- `src/api/` - API client classes and types
- `src/serialization/` - Serialization/deserialization logic
- Most TypeScript files in `src/`

### How to Customize

If you need to customize the SDK, you have two options:

#### Option 1: Use `.fernignore`

For custom code that should persist across SDK regenerations:

1. Create a `.fernignore` file in the project root
2. Add file patterns for files you want to preserve (similar to `.gitignore` syntax)
3. Add your custom code to those files

Files listed in `.fernignore` will not be overwritten when the SDK is regenerated.

For more information, see the [Fern documentation on custom code](https://buildwithfern.com/learn/sdks/overview/custom-code).

#### Option 2: Contribute to the Generator

If you want to change how code is generated for all users of this SDK:

1. The TypeScript SDK generator lives in the [Fern repository](https://github.com/fern-api/fern)
2. Generator code is located at `generators/typescript/sdk/`
3. Follow the [Fern contributing guidelines](https://github.com/fern-api/fern/blob/main/CONTRIBUTING.md)
4. Submit a pull request with your changes to the generator

This approach is best for:
- Bug fixes in generated code
- New features that would benefit all users
- Improvements to code generation patterns

## Making Changes

### Workflow

1. Create a new branch for your changes
2. Make your modifications
3. Run tests to ensure nothing breaks: `pnpm test`
4. Run linting and formatting: `pnpm run check:fix`
5. Build the project: `pnpm build`
6. Commit your changes with a clear commit message
7. Push your branch and create a pull request

### Commit Messages

Write clear, descriptive commit messages that explain what changed and why.

### Code Style

This project uses automated code formatting and linting. Run `pnpm run check:fix` before committing to ensure your code meets the project's style guidelines.

## Questions or Issues?

If you have questions or run into issues:

1. Check the [Fern documentation](https://buildwithfern.com)
2. Search existing [GitHub issues](https://github.com/fern-api/fern/issues)
3. Open a new issue if your question hasn't been addressed

## License

By contributing to this project, you agree that your contributions will be licensed under the Apache License 2.0.
