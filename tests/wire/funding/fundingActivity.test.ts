// This file was auto-generated by Fern from our API Definition.

import * as Payroc from "../../../src/api/index";
import { PayrocClient } from "../../../src/Client";
import { mockServerPool } from "../../mock-server/MockServerPool";
import { mockBearer } from "../mockAuth";

describe("FundingActivityClient", () => {
    test("retrieveBalance (1)", async () => {
        const server = mockServerPool.createServer();
        mockBearer(server);

        const client = new PayrocClient({
            maxRetries: 0,
            apiKey: "x-api-key",
            environment: { api: server.baseUrl, identity: server.baseUrl },
        });

        const rawResponseBody = {
            limit: 2,
            count: 2,
            hasMore: true,
            links: [
                {
                    rel: "previous",
                    method: "get",
                    href: "https://api.payroc.com/v1/funding-balance?before=4525644354&limit=2",
                },
                {
                    rel: "next",
                    method: "get",
                    href: "https://api.payroc.com/v1/funding-balance?after=9876543219&limit=2",
                },
            ],
            data: [
                { merchantId: "4525644354", funds: 120000, pending: 50050, available: 69950, currency: "USD" },
                { merchantId: "9876543219", funds: 50000, pending: 0, available: 50000, currency: "USD" },
            ],
        };
        server.mockEndpoint().get("/funding-balance").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.funding.fundingActivity.retrieveBalance({
            before: "2571",
            after: "8516",
            limit: 1,
            merchantId: "4525644354",
        });
        expect(response).toEqual({
            limit: 2,
            count: 2,
            hasMore: true,
            links: [
                {
                    rel: "previous",
                    method: "get",
                    href: "https://api.payroc.com/v1/funding-balance?before=4525644354&limit=2",
                },
                {
                    rel: "next",
                    method: "get",
                    href: "https://api.payroc.com/v1/funding-balance?after=9876543219&limit=2",
                },
            ],
            data: [
                {
                    merchantId: "4525644354",
                    funds: 120000,
                    pending: 50050,
                    available: 69950,
                    currency: "USD",
                },
                {
                    merchantId: "9876543219",
                    funds: 50000,
                    pending: 0,
                    available: 50000,
                    currency: "USD",
                },
            ],
        });
    });

    test("retrieveBalance (2)", async () => {
        const server = mockServerPool.createServer();
        mockBearer(server);

        const client = new PayrocClient({
            maxRetries: 0,
            apiKey: "x-api-key",
            environment: { api: server.baseUrl, identity: server.baseUrl },
        });

        const rawResponseBody = {
            limit: 10,
            count: 0,
            hasMore: false,
            links: [
                { rel: "previous", method: "get", href: "<uri>" },
                { rel: "next", method: "get", href: "<uri>" },
            ],
            data: [{ merchantId: "4525644354", funds: 120000, pending: 50050, available: 69950, currency: "USD" }],
        };
        server.mockEndpoint().get("/funding-balance").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.funding.fundingActivity.retrieveBalance({
            before: "2571",
            after: "8516",
            limit: 1,
            merchantId: "4525644354",
        });
        expect(response).toEqual({
            limit: 10,
            count: 0,
            hasMore: false,
            links: [
                {
                    rel: "previous",
                    method: "get",
                    href: "<uri>",
                },
                {
                    rel: "next",
                    method: "get",
                    href: "<uri>",
                },
            ],
            data: [
                {
                    merchantId: "4525644354",
                    funds: 120000,
                    pending: 50050,
                    available: 69950,
                    currency: "USD",
                },
            ],
        });
    });

    test("retrieveBalance (3)", async () => {
        const server = mockServerPool.createServer();
        mockBearer(server);

        const client = new PayrocClient({
            maxRetries: 0,
            apiKey: "x-api-key",
            environment: { api: server.baseUrl, identity: server.baseUrl },
        });

        const rawResponseBody = { type: "type", title: "title", status: 1, detail: "detail" };
        server.mockEndpoint().get("/funding-balance").respondWith().statusCode(400).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.funding.fundingActivity.retrieveBalance();
        }).rejects.toThrow(Payroc.BadRequestError);
    });

    test("retrieveBalance (4)", async () => {
        const server = mockServerPool.createServer();
        mockBearer(server);

        const client = new PayrocClient({
            maxRetries: 0,
            apiKey: "x-api-key",
            environment: { api: server.baseUrl, identity: server.baseUrl },
        });

        const rawResponseBody = { type: "type", title: "title", status: 1, detail: "detail" };
        server.mockEndpoint().get("/funding-balance").respondWith().statusCode(401).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.funding.fundingActivity.retrieveBalance();
        }).rejects.toThrow(Payroc.UnauthorizedError);
    });

    test("retrieveBalance (5)", async () => {
        const server = mockServerPool.createServer();
        mockBearer(server);

        const client = new PayrocClient({
            maxRetries: 0,
            apiKey: "x-api-key",
            environment: { api: server.baseUrl, identity: server.baseUrl },
        });

        const rawResponseBody = { key: "value" };
        server.mockEndpoint().get("/funding-balance").respondWith().statusCode(403).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.funding.fundingActivity.retrieveBalance();
        }).rejects.toThrow(Payroc.ForbiddenError);
    });

    test("retrieveBalance (6)", async () => {
        const server = mockServerPool.createServer();
        mockBearer(server);

        const client = new PayrocClient({
            maxRetries: 0,
            apiKey: "x-api-key",
            environment: { api: server.baseUrl, identity: server.baseUrl },
        });

        const rawResponseBody = { type: "type", title: "title", status: 1, detail: "detail" };
        server.mockEndpoint().get("/funding-balance").respondWith().statusCode(406).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.funding.fundingActivity.retrieveBalance();
        }).rejects.toThrow(Payroc.NotAcceptableError);
    });

    test("retrieveBalance (7)", async () => {
        const server = mockServerPool.createServer();
        mockBearer(server);

        const client = new PayrocClient({
            maxRetries: 0,
            apiKey: "x-api-key",
            environment: { api: server.baseUrl, identity: server.baseUrl },
        });

        const rawResponseBody = { type: "type", title: "title", status: 1, detail: "detail" };
        server.mockEndpoint().get("/funding-balance").respondWith().statusCode(500).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.funding.fundingActivity.retrieveBalance();
        }).rejects.toThrow(Payroc.InternalServerError);
    });
});
