// This file was auto-generated by Fern from our API Definition.

import * as Payroc from "../../src/api/index";
import { PayrocClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";
import { mockBearer } from "./mockAuth";

describe("ApplePaySessionsClient", () => {
    test("create (1)", async () => {
        const server = mockServerPool.createServer();
        mockBearer(server);

        const client = new PayrocClient({
            maxRetries: 0,
            apiKey: "x-api-key",
            environment: { api: server.baseUrl, identity: server.baseUrl },
        });
        const rawRequestBody = {
            appleDomainId: "DUHDZJHGYY",
            appleValidationUrl: "https://apple-pay-gateway.apple.com/paymentservices/startSession",
        };
        const rawResponseBody = {
            startSessionResponse:
                '{\n  "epochTimestamp": 1736264582447,\n  "expiresAt": 1736268182447,\n  "merchantSessionIdentifier": "SSHE464E2B91B714F18BFD19D46D0F582BF_916523AAED1343F5BC5815E12BEE9250AFFDC1A17C46B0DE5A943F0F94927C24",\n  "nonce": "e5775127",\n  "merchantIdentifier": "BFB110EE83BE2AF4AA7468926C926CCFC57F4A541CCE6E7F3BEFD05002ECE503",\n  "domainName": "store.com",\n  "displayName": "Store One",\n  "signature": "a1b1c012345678a000b000c0012345d0e0f010g10061a031i001j071k0a1b0c1d0e1234567890120f1g0h1i0j1k0a1b0123451c012d0e1f0g1h0i1j123k1a1b1c1d1e1f1g123h1i1j1k1a1b1c1d1e1f1g123h123i1j123k12340a120a12345b012c0123012d0d1e0f1g0h1i123j123k10000",\n  "operationalAnalyticsIdentifier": "Store One:BFB110EE83BE2AF4AA7468926C926CCFC57F4A541CCE6E7F3BEFD05002ECE503",\n  "retries": 0,\n  "pspId": "17D4AAA8D9357D26D771ABA0DAA0B9D3BB462AD1585492E1FE688AF8BB9558E5"\n}\n',
        };
        server
            .mockEndpoint()
            .post("/processing-terminals/1234001/apple-pay-sessions")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.applePaySessions.create({
            processingTerminalId: "1234001",
            appleDomainId: "DUHDZJHGYY",
            appleValidationUrl: "https://apple-pay-gateway.apple.com/paymentservices/startSession",
        });
        expect(response).toEqual({
            startSessionResponse:
                '{\n  "epochTimestamp": 1736264582447,\n  "expiresAt": 1736268182447,\n  "merchantSessionIdentifier": "SSHE464E2B91B714F18BFD19D46D0F582BF_916523AAED1343F5BC5815E12BEE9250AFFDC1A17C46B0DE5A943F0F94927C24",\n  "nonce": "e5775127",\n  "merchantIdentifier": "BFB110EE83BE2AF4AA7468926C926CCFC57F4A541CCE6E7F3BEFD05002ECE503",\n  "domainName": "store.com",\n  "displayName": "Store One",\n  "signature": "a1b1c012345678a000b000c0012345d0e0f010g10061a031i001j071k0a1b0c1d0e1234567890120f1g0h1i0j1k0a1b0123451c012d0e1f0g1h0i1j123k1a1b1c1d1e1f1g123h1i1j1k1a1b1c1d1e1f1g123h123i1j123k12340a120a12345b012c0123012d0d1e0f1g0h1i123j123k10000",\n  "operationalAnalyticsIdentifier": "Store One:BFB110EE83BE2AF4AA7468926C926CCFC57F4A541CCE6E7F3BEFD05002ECE503",\n  "retries": 0,\n  "pspId": "17D4AAA8D9357D26D771ABA0DAA0B9D3BB462AD1585492E1FE688AF8BB9558E5"\n}\n',
        });
    });

    test("create (2)", async () => {
        const server = mockServerPool.createServer();
        mockBearer(server);

        const client = new PayrocClient({
            maxRetries: 0,
            apiKey: "x-api-key",
            environment: { api: server.baseUrl, identity: server.baseUrl },
        });
        const rawRequestBody = { appleDomainId: "appleDomainId", appleValidationUrl: "appleValidationUrl" };
        const rawResponseBody = { type: "type", title: "title", status: 1, detail: "detail" };
        server
            .mockEndpoint()
            .post("/processing-terminals/processingTerminalId/apple-pay-sessions")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.applePaySessions.create({
                processingTerminalId: "processingTerminalId",
                appleDomainId: "appleDomainId",
                appleValidationUrl: "appleValidationUrl",
            });
        }).rejects.toThrow(Payroc.BadRequestError);
    });

    test("create (3)", async () => {
        const server = mockServerPool.createServer();
        mockBearer(server);

        const client = new PayrocClient({
            maxRetries: 0,
            apiKey: "x-api-key",
            environment: { api: server.baseUrl, identity: server.baseUrl },
        });
        const rawRequestBody = { appleDomainId: "appleDomainId", appleValidationUrl: "appleValidationUrl" };
        const rawResponseBody = { type: "type", title: "title", status: 1, detail: "detail" };
        server
            .mockEndpoint()
            .post("/processing-terminals/processingTerminalId/apple-pay-sessions")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(500)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.applePaySessions.create({
                processingTerminalId: "processingTerminalId",
                appleDomainId: "appleDomainId",
                appleValidationUrl: "appleValidationUrl",
            });
        }).rejects.toThrow(Payroc.InternalServerError);
    });
});
